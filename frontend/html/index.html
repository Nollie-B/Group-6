<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>F2C Solutions — Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link href="../styles/custom.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/chart.js" rel="stylesheet">
  <style>
    .dashboard-metric {
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      border: 1px solid #e9ecef;
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .dashboard-metric:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    
    .metric-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: #343a40;
      margin: 0;
      line-height: 1;
    }
    
    .metric-label {
      font-size: 0.875rem;
      color: #6c757d;
      margin-top: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }
    
    .metric-trend {
      position: absolute;
      top: 12px;
      right: 12px;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .trend-up {
      background-color: #d4edda;
      color: #155724;
    }
    
    .trend-down {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .chart-container {
      background: white;
      border-radius: 12px;
      padding: 24px;
      border: 1px solid #e9ecef;
      height: 400px;
      position: relative;
    }
    
    .chart-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #343a40;
      margin-bottom: 16px;
    }
    
    .activity-item {
      padding: 12px 0;
      border-bottom: 1px solid #f1f3f4;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .activity-item:last-child {
      border-bottom: none;
    }
    
    .activity-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    .activity-icon.success {
      background-color: #d4edda;
      color: #155724;
    }
    
    .activity-icon.info {
      background-color: #d1ecf1;
      color: #0c5460;
    }
    
    .activity-icon.warning {
      background-color: #fff3cd;
      color: #856404;
    }
    
    .alert-card {
      background: linear-gradient(135deg, #fff5f5 0%, #ffffff 100%);
      border: 1px solid #fed7d7;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }
    
    .alert-title {
      font-weight: 600;
      color: #c53030;
      font-size: 0.9rem;
      margin-bottom: 4px;
    }
    
    .alert-description {
      font-size: 0.8rem;
      color: #718096;
      margin: 0;
    }
    
    /* Spoilage Alerts Styles */
    .spoilage-alerts-card {
      background: white;
      border-radius: 12px;
      border: 1px solid #e9ecef;
      overflow: hidden;
    }
    
    .spoilage-alerts-header {
      background: #f8f9fa;
      padding: 20px 24px;
      border-bottom: 1px solid #e9ecef;
    }
    
    .spoilage-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.25rem;
      font-weight: 600;
      color: #343a40;
      margin-bottom: 4px;
    }
    
    .spoilage-icon {
      color: #fd7e14;
      font-size: 1.1rem;
    }
    
    .spoilage-subtitle {
      color: #6c757d;
      font-size: 0.875rem;
      margin: 0;
    }
    
    .spoilage-alerts-list {
      padding: 0;
    }
    
    .spoilage-alert-item {
      padding: 16px 24px;
      border-bottom: 1px solid #f1f3f4;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.2s ease;
    }
    
    .spoilage-alert-item:last-child {
      border-bottom: none;
    }
    
    .spoilage-alert-item:hover {
      background-color: #f8f9fa;
    }
    
    .spoilage-alert-item.urgent {
      border-left: 4px solid #dc3545;
    }
    
    .spoilage-alert-item.warning {
      border-left: 4px solid #fd7e14;
    }
    
    .spoilage-product-info {
      flex: 1;
    }
    
    .spoilage-product-name {
      font-weight: 600;
      color: #343a40;
      margin: 0 0 4px 0;
      font-size: 0.95rem;
    }
    
    .spoilage-product-details {
      color: #6c757d;
      font-size: 0.875rem;
      margin: 0;
    }
    
    .spoilage-urgency-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .spoilage-urgency-badge.urgent {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .spoilage-urgency-badge.warning {
      background-color: #d4edda;
      color: #155724;
    }
    
    .spoilage-empty-state {
      padding: 40px 24px;
      text-align: center;
      color: #6c757d;
    }
    
    .spoilage-empty-state i {
      font-size: 2rem;
      margin-bottom: 12px;
      opacity: 0.5;
    }
    
    .quick-action-card {
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
      display: block;
    }
    
    .quick-action-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      text-decoration: none;
      color: inherit;
    }
    
    .quick-action-icon {
      font-size: 2rem;
      margin-bottom: 12px;
      color: #5a8a59;
    }
    
    .quick-action-title {
      font-weight: 600;
      color: #343a40;
      margin-bottom: 4px;
    }
    
    .quick-action-desc {
      font-size: 0.8rem;
      color: #6c757d;
      margin: 0;
    }
    
    /* Weather widget removed (not used) */
  </style>
</head>
<body>
  <!-- Primary navbar (loaded via component) -->
  <div id="navbar"></div>
  
  <!-- Fallback navbar (shown if component loading fails) -->
  <div id="navbar-fallback" style="display: none;">
    <nav class="main-navbar" style="background-color: #f8f9fa; border-bottom: 1px solid #e9ecef; position: sticky; top: 0; z-index: 1000;">
      <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; min-height: 80px;">
        <div style="display: flex; align-items: center; gap: 12px; text-decoration: none; color: #333;">
          <div style="width: 40px; height: 40px; background-color: #5a8a59; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">F2C</div>
          <div>
            <h1 style="font-size: 18px; font-weight: 700; color: #333; margin: 0;">F2C Solutions</h1>
            <p style="font-size: 12px; color: #666; margin: 0;">Farmer to Customer</p>
          </div>
        </div>
        <div style="display: flex; gap: 8px;">
          <a href="../html/dashboard.html" style="padding: 12px 16px; text-decoration: none; color: #666; border-radius: 8px; background-color: #5a8a59; color: white;">Dashboard</a>
          <a href="../html/inventory.html" style="padding: 12px 16px; text-decoration: none; color: #666; border-radius: 8px;">Inventory</a>
          <a href="../html/analytics.html" style="padding: 12px 16px; text-decoration: none; color: #666; border-radius: 8px;">Analytics</a>
          <a href="../html/shop.html" style="padding: 12px 16px; text-decoration: none; color: #666; border-radius: 8px;">Marketplace</a>
          <a href="../html/tracking.html" style="padding: 12px 16px; text-decoration: none; color: #666; border-radius: 8px;">Orders</a>
          <a href="../html/auth.html" style="padding: 12px 16px; text-decoration: none; color: #666; border-radius: 8px;">Profile</a>
        </div>
      </div>
    </nav>
  </div>

  <main class="container-fluid py-4">
    <!-- Welcome Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h1 class="h2 mb-1">Dashboard</h1>
            <p class="text-muted mb-0">Welcome back! Here's what's happening with your farm today.</p>
          </div>
          <div>
            <button class="btn btn-success">
              <i class="fas fa-plus me-2"></i>Add Product
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Key Metrics -->
    <div class="row g-4 mb-4">
      <div class="col-lg-3 col-md-6">
        <div class="dashboard-metric">
          <div class="metric-trend trend-up">
            <i class="fas fa-arrow-up me-1"></i>12%
          </div>
          <div class="metric-value">R24,560</div>
          <div class="metric-label">Monthly Revenue</div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="dashboard-metric">
          <div class="metric-trend trend-up">
            <i class="fas fa-arrow-up me-1"></i>8%
          </div>
          <div class="metric-value">127</div>
          <div class="metric-label">Active Orders</div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="dashboard-metric">
          <div class="metric-trend trend-down">
            <i class="fas fa-arrow-down me-1"></i>3%
          </div>
          <div class="metric-value">45</div>
          <div class="metric-label">Low Stock Items</div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="dashboard-metric">
          <div class="metric-trend trend-up">
            <i class="fas fa-arrow-up me-1"></i>15%
          </div>
          <div class="metric-value">89%</div>
          <div class="metric-label">Customer Satisfaction</div>
        </div>
      </div>
    </div>

    <!-- Spoilage Alerts Section -->
    <div class="row g-4 mb-4">
      <div class="col-12">
        <div class="spoilage-alerts-card">
          <div class="spoilage-alerts-header">
            <div class="spoilage-title">
              <i class="fas fa-exclamation-triangle spoilage-icon"></i>
              <span>Spoilage Alerts</span>
            </div>
            <p class="spoilage-subtitle">Products approaching expiration dates</p>
          </div>
          
          <div class="spoilage-alerts-list" id="spoilageAlertsList">
            <!-- Spoilage alerts will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <div class="row g-4">
      <!-- Revenue Chart -->
      <div class="col-lg-8">
        <div class="chart-container">
          <div class="chart-title">Revenue Overview</div>
          <canvas id="revenueChart"></canvas>
        </div>
      </div>
      
      <!-- Weather Widget -->
      <div class="col-lg-4">
        <!-- Weather widget removed -->
        
        <!-- Alerts -->
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">
              <i class="fas fa-exclamation-triangle text-warning me-2"></i>
              Alerts
            </h5>
            
            <div class="alert-card">
              <div class="alert-title">Low Stock Alert</div>
              <p class="alert-description">Tomatoes running low (5 units remaining)</p>
            </div>
            
            <div class="alert-card">
              <div class="alert-title">New Order</div>
              <p class="alert-description">Order #1247 - Organic Lettuce Bundle</p>
            </div>
            
            <div class="alert-card">
              <div class="alert-title">Weather Warning</div>
              <p class="alert-description">Frost expected tonight - protect sensitive crops</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-4 mt-2">
      <!-- Sales by Product -->
      <div class="col-lg-6">
        <div class="chart-container">
          <div class="chart-title">Sales by Product Category</div>
          <canvas id="productChart"></canvas>
        </div>
      </div>
      
      <!-- Recent Activity -->
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title">
              <i class="fas fa-clock text-info me-2"></i>
              Recent Activity
            </h5>
            
            <div class="activity-item">
              <div class="activity-icon success">
                <i class="fas fa-check"></i>
              </div>
              <div>
                <div class="fw-bold">Order Delivered</div>
                <small class="text-muted">Organic vegetables to Green Valley Market</small>
              </div>
            </div>
            
            <div class="activity-item">
              <div class="activity-icon info">
                <i class="fas fa-plus"></i>
              </div>
              <div>
                <div class="fw-bold">New Product Added</div>
                <small class="text-muted">Fresh Basil - 50 units added to inventory</small>
              </div>
            </div>
            
            <div class="activity-item">
              <div class="activity-icon success">
                <i class="fas fa-dollar-sign"></i>
              </div>
              <div>
                <div class="fw-bold">Payment Received</div>
                <small class="text-muted">R189.50 from Customer #34</small>
              </div>
            </div>
            
            <div class="activity-item">
              <div class="activity-icon warning">
                <i class="fas fa-exclamation"></i>
              </div>
              <div>
                <div class="fw-bold">Low Stock Warning</div>
                <small class="text-muted">Carrots at 8 units - restock needed</small>
              </div>
            </div>
            
            <div class="activity-item">
              <div class="activity-icon info">
                <i class="fas fa-star"></i>
              </div>
              <div>
                <div class="fw-bold">5-Star Review</div>
                <small class="text-muted">"Amazing fresh produce quality!"</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="row g-4 mt-4">
      <div class="col-12">
        <h5 class="mb-3">Quick Actions</h5>
      </div>
      <div class="col-lg-2 col-md-4 col-6">
        <a href="inventory.html" class="quick-action-card">
          <div class="quick-action-icon">
            <i class="fas fa-boxes"></i>
          </div>
          <div class="quick-action-title">Manage Inventory</div>
          <p class="quick-action-desc">Add, edit, or remove products</p>
        </a>
      </div>
      <div class="col-lg-2 col-md-4 col-6">
        <a href="shop.html" class="quick-action-card">
          <div class="quick-action-icon">
            <i class="fas fa-store"></i>
          </div>
          <div class="quick-action-title">Marketplace</div>
          <p class="quick-action-desc">View your online store</p>
        </a>
      </div>
      <div class="col-lg-2 col-md-4 col-6">
        <a href="tracking.html" class="quick-action-card">
          <div class="quick-action-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="quick-action-title">Analytics</div>
          <p class="quick-action-desc">View detailed reports</p>
        </a>
      </div>
      <div class="col-lg-2 col-md-4 col-6">
        <a href="tracking.html" class="quick-action-card">
          <div class="quick-action-icon">
            <i class="fas fa-clipboard-list"></i>
          </div>
          <div class="quick-action-title">Orders</div>
          <p class="quick-action-desc">Manage customer orders</p>
        </a>
      </div>
      <div class="col-lg-2 col-md-4 col-6">
        <a href="#" class="quick-action-card">
          <div class="quick-action-icon">
            <i class="fas fa-camera"></i>
          </div>
          <div class="quick-action-title">Upload Photos</div>
          <p class="quick-action-desc">Add product images</p>
        </a>
      </div>
      <div class="col-lg-2 col-md-4 col-6">
        <a href="auth.html" class="quick-action-card">
          <div class="quick-action-icon">
            <i class="fas fa-user-cog"></i>
          </div>
          <div class="quick-action-title">Profile</div>
          <p class="quick-action-desc">Manage your account</p>
        </a>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="../js/components.js"></script>
  <script>
    console.log('Loading navbar component...');
    
    // Load navbar component with error handling
    loadComponent("navbar", "../components/navbar.html").then(() => {
      console.log('Navbar component loaded successfully');
      // Hide fallback navbar if main navbar loaded successfully
      const fallback = document.getElementById('navbar-fallback');
      if (fallback) {
        fallback.style.display = 'none';
      }
    }).catch((error) => {
      console.error('Failed to load navbar component:', error);
      
      // Show fallback navbar
      const fallback = document.getElementById('navbar-fallback');
      if (fallback) {
        fallback.style.display = 'block';
        console.log('Fallback navbar shown');
      }
      
      // Try fallback method
      fetch('../components/navbar.html')
        .then(response => response.text())
        .then(html => {
          const navbarElement = document.getElementById('navbar');
          if (navbarElement) {
            navbarElement.innerHTML = html;
            console.log('Navbar loaded via fallback method');
            // Hide fallback navbar if successful
            const fallback = document.getElementById('navbar-fallback');
            if (fallback) {
              fallback.style.display = 'none';
            }
          }
        })
        .catch(fallbackError => {
          console.error('Fallback navbar loading failed:', fallbackError);
        });
    });

    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    new Chart(revenueCtx, {
      type: 'line',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        datasets: [{
          label: 'Revenue',
          data: [12000, 15000, 18000, 22000, 25000, 28000, 32000, 35000, 38000, 42000, 45000, 48000],
          borderColor: '#5a8a59',
          backgroundColor: 'rgba(90, 138, 89, 0.1)',
          borderWidth: 3,
          fill: true,
          tension: 0.4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
                callback: function(value) {
                return 'R' + value.toLocaleString();
              }
            }
          }
        }
      }
    });

    // Product Sales Chart
    const productCtx = document.getElementById('productChart').getContext('2d');
    new Chart(productCtx, {
      type: 'doughnut',
      data: {
        labels: ['Vegetables', 'Fruits', 'Herbs', 'Dairy', 'Other'],
        datasets: [{
          data: [35, 25, 20, 15, 5],
          backgroundColor: [
            '#5a8a59',
            '#8bb17c',
            '#a8d4a3',
            '#c8e6c9',
            '#e8f5e9'
          ],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });

    // Spoilage Alerts System
    function loadSpoilageAlerts() {
      const alertsList = document.getElementById('spoilageAlertsList');
      if (!alertsList) return;

      // Sample spoilage data - in a real app, this would come from your inventory database
      const spoilageData = [
        {
          name: "Organic Tomatoes",
          quantity: "25kg",
          expiryDays: 2,
          urgency: "urgent",
          category: "vegetables"
        },
        {
          name: "Fresh Lettuce",
          quantity: "15kg",
          expiryDays: 3,
          urgency: "warning",
          category: "vegetables"
        },
        {
          name: "Strawberries",
          quantity: "10kg",
          expiryDays: 1,
          urgency: "urgent",
          category: "fruits"
        },
        {
          name: "Avocados",
          quantity: "8kg",
          expiryDays: 2,
          urgency: "urgent",
          category: "fruits"
        },
        {
          name: "Spinach",
          quantity: "12kg",
          expiryDays: 4,
          urgency: "warning",
          category: "vegetables"
        }
      ];

      // Filter alerts to only show items expiring within 7 days
      const activeAlerts = spoilageData.filter(item => item.expiryDays <= 7);

      if (activeAlerts.length === 0) {
        alertsList.innerHTML = `
          <div class="spoilage-empty-state">
            <i class="fas fa-check-circle"></i>
            <p>All products are fresh! No spoilage alerts at this time.</p>
          </div>
        `;
        return;
      }

      // Sort by urgency (urgent first) then by days until expiry
      activeAlerts.sort((a, b) => {
        if (a.urgency === 'urgent' && b.urgency === 'warning') return -1;
        if (a.urgency === 'warning' && b.urgency === 'urgent') return 1;
        return a.expiryDays - b.expiryDays;
      });

      // Generate HTML for each alert
      const alertsHTML = activeAlerts.map(item => {
        const urgencyClass = item.urgency;
        const urgencyText = item.urgency === 'urgent' ? 'Urgent' : 'Warning';
        const urgencyBadgeClass = item.urgency;
        const daysText = item.expiryDays === 1 ? 'day' : 'days';
        
        return `
          <div class="spoilage-alert-item ${urgencyClass}">
            <div class="spoilage-product-info">
              <div class="spoilage-product-name">${item.name}</div>
              <div class="spoilage-product-details">
                ${item.quantity} • Expires in ${item.expiryDays} ${daysText}
              </div>
            </div>
            <div class="spoilage-urgency-badge ${urgencyBadgeClass}">
              ${urgencyText}
            </div>
          </div>
        `;
      }).join('');

      alertsList.innerHTML = alertsHTML;
    }

    // Initialize spoilage alerts when page loads
    document.addEventListener('DOMContentLoaded', loadSpoilageAlerts);

    // Refresh alerts every 5 minutes
    setInterval(loadSpoilageAlerts, 5 * 60 * 1000);

  </script>
</body>
</html>