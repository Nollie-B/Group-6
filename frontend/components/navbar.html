<!-- Top decorative bar -->
<div class="top-bar"></div>

<!-- Main Navigation -->
<nav class="main-navbar">
  <div class="navbar-container">
    
    <!-- Brand Section -->
    <div class="navbar-brand">
      <div class="brand-logo">
        <img src="../assets/f2c_logo.svg" alt="F2C Logo" width="40" height="40" />
      </div>
      <div class="brand-text">
        <h1>F2C Solutions</h1>
        <p>Farmer to Customer</p>
      </div>
    </div>

    <!-- Burger Menu Button -->
    <button class="navbar-toggle" id="navbar-toggle" aria-label="Toggle navigation">
      <span class="hamburger"></span>
      <span class="hamburger"></span>
      <span class="hamburger"></span>
    </button>

    <!-- Navigation Menu -->
    <div class="navbar-menu" id="navbar-menu">
      <ul class="navbar-nav">
        <li class="nav-item" data-page="dashboard">
          <a class="nav-link" href="../html/dashboard.html">
            <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
              <rect x="3" y="3" width="7" height="7" rx="1" fill="currentColor"/>
              <rect x="14" y="3" width="7" height="7" rx="1" fill="currentColor"/>
              <rect x="14" y="14" width="7" height="7" rx="1" fill="currentColor"/>
              <rect x="3" y="14" width="7" height="7" rx="1" fill="currentColor"/>
            </svg>
            Dashboard
          </a>
        </li>
        <li class="nav-item" data-page="inventory">
          <a class="nav-link" href="../html/inventory.html">
            <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M20 6H16V4C16 3.45 15.55 3 15 3H9C8.45 3 8 3.45 8 4V6H4C2.9 6 2 6.9 2 8V19C2 20.1 2.9 21 4 21H20C21.1 21 22 20.1 22 19V8C22 6.9 21.1 6 20 6ZM10 4H14V6H10V4ZM16 13H13V16H11V13H8V11H11V8H13V11H16V13Z" fill="currentColor"/>
            </svg>
            Inventory
          </a>
        </li>
        <li class="nav-item" data-page="analytics">
          <a class="nav-link" href="../html/analytics.html">
            <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M3.5 18.49L6 16.49L10.5 12.49L13 15.49L18.5 6.49H22L18.5 18.49H3.5Z" fill="currentColor"/>
            </svg>
            Analytics
          </a>
        </li>
        <li class="nav-item" data-page="marketplace">
          <a class="nav-link" href="../html/shop.html">
            <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M7 18C7 19.1 7.9 20 9 20H19C20.1 20 21 19.1 21 18C21 17.45 20.8 16.95 20.5 16.6L17.6 13.7C17.2 13.3 16.6 13.3 16.2 13.7L15.7 14.2C15.3 14.6 14.7 14.6 14.3 14.2L13.8 13.7C13.4 13.3 12.8 13.3 12.4 13.7L11.9 14.2C11.5 14.6 10.9 14.6 10.5 14.2L10 13.7C9.6 13.3 9 13.3 8.6 13.7L5.7 16.6C5.4 16.95 5.2 17.45 5.2 18H7Z" fill="currentColor"/>
            </svg>
            Marketplace
          </a>
        </li>
        <li class="nav-item" data-page="orders" id="ordersNavItem">
          <a class="nav-link" href="../html/tracking.html" id="ordersNavLink">
            <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M14 2H6C5.5 2 5 2.45 5 3V21C5 21.55 5.45 22 6 22H18C18.55 22 19 21.55 19 21V7L14 2ZM18 20H6V4H13V9H18V20Z" fill="currentColor"/>
            </svg>
            Orders
            <span class="orders-badge" id="ordersBadge" style="display:none">0</span>
          </a>

          <!-- Orders preview dropdown (shows up on hover/click) -->
          <div class="orders-dropdown" id="ordersDropdown" aria-hidden="true">
            <div class="orders-dropdown-inner">
              <!-- Render the same Recent Orders card used on tracking.html here -->
              <div class="order-card" style="margin:0;">
                <h3 class="h5 mb-3">Recent Orders</h3>
                <div id="ordersContainerNavbar">
                  <div class="text-center text-muted py-4">
                    <i class="fas fa-shopping-cart fa-3x mb-3"></i>
                    <p>No orders found</p>
                    <small>Orders will appear here when customers make purchases</small>
                  </div>
                </div>
              </div>
              <div class="orders-footer"><a href="../html/tracking.html">View All Orders</a></div>
            </div>
          </div>
        </li>
        <li class="nav-item" data-page="profile">
          <a class="nav-link" href="../html/auth.html">
            <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M12 12C14.8 12 17 9.8 17 7C17 4.2 14.8 2 12 2C9.2 2 7 4.2 7 7C7 9.8 9.2 12 12 12ZM12 14C8.1 14 5 16.9 5 20V21C5 21.55 5.45 22 6 22H18C18.55 22 19 21.55 19 21V20C19 16.9 15.9 14 12 14Z" fill="currentColor"/>
            </svg>
            Profile
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<style>
/* Reset and Base Styles */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

/* Top decorative bar */
.top-bar {
  height: 4px;
  background-color: #333;
  width: 100%;
}

/* Main Navbar Styles */
.main-navbar {
  background-color: #f8f9fa;
  border-bottom: 1px solid #e9ecef;
  position: sticky;
  top: 0;
  z-index: 1000;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.navbar-container {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  min-height: 80px;
}

/* Brand Section */
.navbar-brand {
  display: flex;
  align-items: center;
  gap: 12px;
  text-decoration: none;
  color: #333;
}

.brand-logo img {
  width: 40px;
  height: 40px;
}

.brand-text h1 {
  font-size: 18px;
  font-weight: 700;
  color: #333;
  margin: 0;
  line-height: 1.2;
}

.brand-text p {
  font-size: 12px;
  color: #666;
  margin: 0;
  font-weight: 400;
}

/* Burger Menu Button */
.navbar-toggle {
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 30px;
  height: 30px;
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
  gap: 4px;
}

.hamburger {
  width: 24px;
  height: 2px;
  background-color: #333;
  transition: all 0.3s ease;
  border-radius: 2px;
}

.navbar-toggle.active .hamburger:nth-child(1) {
  transform: rotate(45deg) translate(5px, 5px);
}

.navbar-toggle.active .hamburger:nth-child(2) {
  opacity: 0;
}

.navbar-toggle.active .hamburger:nth-child(3) {
  transform: rotate(-45deg) translate(7px, -6px);
}

/* Navigation Menu */
.navbar-menu {
  display: flex;
}

.navbar-nav {
  display: flex;
  list-style: none;
  gap: 8px;
  margin: 0;
  padding: 0;
}

.nav-item {
  margin: 0;
  position: relative;
}

.nav-link {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 16px;
  text-decoration: none;
  color: #666;
  font-size: 14px;
  font-weight: 500;
  border-radius: 8px;
  transition: all 0.3s ease;
  white-space: nowrap;
}

.nav-icon {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}

/* Active State */
.nav-item.active .nav-link {
  background-color: rgba(90, 138, 89, 0.1);
  color: #5a8a59;
}

.nav-item.active .nav-icon {
  color: #5a8a59;
}

/* Hover State */
.nav-link:hover {
  background-color: rgba(90, 138, 89, 0.05);
  color: #5a8a59;
}

.nav-link:hover .nav-icon {
  color: #5a8a59;
}

/* Orders dropdown preview */
.orders-badge {
  background: #5a8a59;
  color: white;
  font-size: 11px;
  padding: 2px 6px;
  border-radius: 12px;
  margin-left: 8px;
  vertical-align: middle;
}

.orders-dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  width: 320px;
  background: white;
  border: 1px solid #e9ecef;
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.08);
  padding: 8px;
  display: none;
  z-index: 10000;
}

.orders-dropdown-inner { max-height: 300px; overflow: auto; }
.orders-list { list-style: none; margin: 0; padding: 0; }
.orders-list li { padding: 8px; border-bottom: 1px solid #f1f1f1; font-size: 13px; }
.orders-list li:last-child { border-bottom: none; }
.orders-list .order-id { font-weight: 600; margin-right: 6px; }
.orders-list .order-meta { color: #6c757d; font-size: 12px; }
.orders-footer { padding: 8px; text-align: center; }
.orders-loading { padding: 16px; text-align: center; color: #6c757d; }

/* Mobile Responsive */
@media (max-width: 768px) {
  .navbar-toggle {
    display: flex;
  }
  
  .navbar-menu {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: #f8f9fa;
    border-top: 1px solid #e9ecef;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 999;
  }
  
  .navbar-menu.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .navbar-nav {
    flex-direction: column;
    gap: 0;
    padding: 8px 0;
  }
  
  .nav-link {
    padding: 16px 20px;
    border-radius: 0;
    border-bottom: 1px solid #e9ecef;
  }
  
  .nav-link:last-child {
    border-bottom: none;
  }
  
  .brand-text h1 {
    font-size: 16px;
  }
  
  .brand-text p {
    font-size: 11px;
  }
  
  .navbar-container {
    padding: 0 16px;
    min-height: 70px;
  }
}

@media (max-width: 480px) {
  .navbar-brand {
    gap: 8px;
  }
  
  .brand-logo img {
    width: 32px;
    height: 32px;
  }
  
  .brand-text h1 {
    font-size: 14px;
  }
  
  .brand-text p {
    font-size: 10px;
  }
}
</style>

<script>
// Enhanced navbar functionality
(function() {
  'use strict';
  
  const navbarToggle = document.getElementById('navbar-toggle');
  const navbarMenu = document.getElementById('navbar-menu');
  const navLinks = document.querySelectorAll('.nav-link');
  
  // Initialize active state based on current page
  function initActiveState() {
    const currentPage = window.location.pathname.split('/').pop() || 'index.html';
    
    navLinks.forEach(link => {
      const href = link.getAttribute('href');
      const linkPage = href.split('/').pop();
      
      if (linkPage === currentPage || (currentPage === '' && linkPage === 'index.html')) {
        link.parentElement.classList.add('active');
      }
    });
  }
  
  // Toggle mobile menu
  function toggleMobileMenu() {
    navbarToggle.classList.toggle('active');
    navbarMenu.classList.toggle('active');
    
    // Update aria-expanded for accessibility
    const isExpanded = navbarToggle.classList.contains('active');
    navbarToggle.setAttribute('aria-expanded', isExpanded);
  }
  
  // Close mobile menu when clicking nav links
  function closeMobileMenu() {
    if (navbarMenu.classList.contains('active')) {
      navbarToggle.classList.remove('active');
      navbarMenu.classList.remove('active');
      navbarToggle.setAttribute('aria-expanded', 'false');
    }
  }
  
  // Handle navbar toggle click
  if (navbarToggle) {
    navbarToggle.addEventListener('click', toggleMobileMenu);
  }
  
  // Close mobile menu when clicking nav links and dispatch dashboard show event
  navLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      closeMobileMenu();
      try {
        const href = this.getAttribute('href') || '';
        const page = href.split('/').pop();
        if (page === 'index.html' || page === 'dashboard.html') {
          document.dispatchEvent(new CustomEvent('f2c:show-dashboard'));
        }

        // If the Orders link is clicked, notify any open Orders page to refresh
        if (page === 'tracking.html') {
          document.dispatchEvent(new CustomEvent('f2c:show-orders'));
        }
      } catch (err) {
        // swallow
      }
    });
  });
  
  // Close mobile menu when clicking outside
  document.addEventListener('click', function(event) {
    const isClickInsideNavbar = event.target.closest('.main-navbar');
    
    if (!isClickInsideNavbar && navbarMenu.classList.contains('active')) {
      closeMobileMenu();
    }
  });
  
  // Close mobile menu on window resize to desktop size
  window.addEventListener('resize', function() {
    if (window.innerWidth > 768 && navbarMenu.classList.contains('active')) {
      closeMobileMenu();
    }
  });
  
  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    initActiveState();
  });
  
})();

// Orders preview dropdown population
(function() {
  function formatDate(iso) {
    try { return new Date(iso).toLocaleDateString(); } catch (e) { return iso; }
  }

  const ordersNavItem = document.getElementById('ordersNavItem');
  const ordersDropdown = document.getElementById('ordersDropdown');
  const ordersContainerNavbar = document.getElementById('ordersContainerNavbar');
  const ordersBadge = document.getElementById('ordersBadge');

  function populateOrdersPreview() {
    if (!ordersContainerNavbar) return;

    ordersContainerNavbar.innerHTML = '';

    const orders = JSON.parse(localStorage.getItem('orders')) || [];
    const count = orders.length;

    if (ordersBadge) {
      if (count > 0) { ordersBadge.style.display = 'inline-block'; ordersBadge.textContent = count; }
      else { ordersBadge.style.display = 'none'; }
    }

    if (count === 0) {
      ordersContainerNavbar.innerHTML = `
        <div class="text-center text-muted py-4">
          <i class="fas fa-shopping-cart fa-3x mb-3"></i>
          <p>No orders found</p>
          <small>Orders will appear here when customers make purchases</small>
        </div>`;
      return;
    }

    // Show up to 5 most recent orders (render similar structure to tracking page)
    const recent = orders.slice().reverse().slice(0,5);
    ordersContainerNavbar.innerHTML = recent.map(order => `
      <div class="order-card" style="margin-bottom:10px;">
        <div class="d-flex justify-content-between align-items-start mb-3">
          <div>
            <div class="order-id">Order #${order.id}</div>
            <div class="order-date">${formatDate(order.date || order.orderDate || order.order_date)}</div>
          </div>
          <span class="status-badge status-${(order.status || '').toString().toLowerCase()}">${((order.status || '').toString().charAt(0) || '').toUpperCase() + ((order.status || '').toString().slice(1) || '')}</span>
        </div>
        <div class="order-items">
          ${ (order.items || []).map(item => `
            <div class="order-item">
              <span>${item.name} x${item.quantity}</span>
              <span>R${((item.price||0) * (item.quantity||0)).toFixed(2)}</span>
            </div>
          `).join('') }
        </div>
        <div class="order-total">
          <span>Total</span>
          <span>R${((order.total||order.totalAmount||0)).toFixed(2)}</span>
        </div>
      </div>
    `).join('');
  }

  if (ordersNavItem) {
    // show on hover / focus
    ordersNavItem.addEventListener('mouseenter', function() {
      populateOrdersPreview();
      ordersDropdown.style.display = 'block';
      ordersDropdown.setAttribute('aria-hidden','false');
    });
    ordersNavItem.addEventListener('mouseleave', function() {
      ordersDropdown.style.display = 'none';
      ordersDropdown.setAttribute('aria-hidden','true');
    });

    // also show on click (useful for mobile) and prevent navigation when dropdown hidden
    const ordersNavLink = document.getElementById('ordersNavLink');
    if (ordersNavLink) {
      ordersNavLink.addEventListener('click', function(e) {
        // If dropdown is hidden, show it instead of navigating
        if (ordersDropdown.style.display === 'none') {
          e.preventDefault();
          populateOrdersPreview();
          ordersDropdown.style.display = 'block';
          ordersDropdown.setAttribute('aria-hidden','false');
        }
        // Otherwise allow default navigation to tracking.html
      });
    }
  }

  // Update badge when orders change via storage events
  window.addEventListener('storage', function(e) {
    if (e.key === 'orders') populateOrdersPreview();
  });

  // Update when the app dispatches an in-page ordersUpdated event
  window.addEventListener('ordersUpdated', function() {
    populateOrdersPreview();
  });

  // initial populate
  try { populateOrdersPreview(); } catch (e) {}

})();
</script>